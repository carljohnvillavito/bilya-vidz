<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BilyaVidz - AI Video Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
    body {
        margin: 0;
        font-family: 'Roboto', sans-serif;
        background-color: #f7f8fa;
        color: #333;
    }
    header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background-color: #222;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        z-index: 10;
    }
    header h1 {
        font-size: 20px;
        margin: 0;
    }
    .burger {
        font-size: 24px;
        cursor: pointer;
    }
    .drawer {
        position: fixed;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100%;
        background: #fff;
        box-shadow: -2px 0 8px rgba(0,0,0,0.2);
        padding: 20px;
        overflow-y: auto;
        transition: right 0.3s ease;
        z-index: 20;
    }
    .drawer.open {
        right: 0;
    }
    .drawer h2 {
        margin-top: 0;
        font-size: 18px;
        border-bottom: 1px solid #ddd;
        padding-bottom: 8px;
    }
    .history-item {
        font-size: 14px;
        padding: 6px 0;
        border-bottom: 1px solid #eee;
    }
    main {
        padding-top: 80px;
        max-width: 800px;
        margin: auto;
        text-align: center;
    }
    video {
        width: 100%;
        max-height: 400px;
        background: #ccc;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    textarea {
        width: 100%;
        height: 120px;
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        resize: none;
        margin-bottom: 20px;
    }
    .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    label {
        display: flex;
        align-items: center;
        font-size: 14px;
    }
    label input {
        margin-right: 8px;
    }
    button {
        background: #007BFF;
        color: white;
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
    }
    button:disabled {
        background: #999;
        cursor: not-allowed;
    }
</style>
</head>
<body>

<header>
    <h1>BilyaVidz</h1>
    <div class="burger" id="burger">â˜°</div>
</header>

<div class="drawer" id="drawer">
    <h2>Generation History</h2>
    <div id="history"></div>
</div>

<main>
    <video id="videoPreview" controls></video>
    <div class="controls">
        <label>
            <input type="checkbox" id="downloadToggle"> Download MP4
        </label>
        <button id="generateBtn">Generate</button>
    </div>
    <textarea id="promptInput" placeholder="Describe your video idea here..."></textarea>
</main>

<script type="module">
import { GoogleGenAI } from "https://cdn.jsdelivr.net/npm/@google/genai/+esm";

const ai = new GoogleGenAI({
    apiKey: "AIzaSyDWw2BDLVDr8oQQjNli_Ayl__0bAg8_O2c"
});

const burger = document.getElementById("burger");
const drawer = document.getElementById("drawer");
const historyDiv = document.getElementById("history");
const promptInput = document.getElementById("promptInput");
const generateBtn = document.getElementById("generateBtn");
const videoPreview = document.getElementById("videoPreview");
const downloadToggle = document.getElementById("downloadToggle");

let historyList = JSON.parse(localStorage.getItem("bilyavids_history") || "[]");

// Render history
function renderHistory() {
    historyDiv.innerHTML = "";
    historyList.forEach(item => {
        const div = document.createElement("div");
        div.className = "history-item";
        div.textContent = `${item.timestamp} - ${item.prompt}`;
        historyDiv.appendChild(div);
    });
}
renderHistory();

burger.onclick = () => {
    drawer.classList.toggle("open");
};

generateBtn.onclick = async () => {
    const prompt = promptInput.value.trim();
    if (!prompt) {
        alert("Please enter a prompt!");
        return;
    }

    generateBtn.disabled = true;
    generateBtn.textContent = "Generating...";

    try {
        let operation = await ai.models.generateVideos({
            model: "veo-3.0-generate-preview",
            prompt: prompt
        });

        while (!operation.done) {
            console.log("Waiting for video generation...");
            await new Promise(res => setTimeout(res, 10000));
            operation = await ai.operations.getVideosOperation({
                operation: operation
            });
        }

        const videoUrl = operation.response.generatedVideos[0].video.uri;
        videoPreview.src = videoUrl;

        // Save history
        const newEntry = {
            timestamp: new Date().toLocaleString(),
            prompt
        };
        historyList.unshift(newEntry);
        localStorage.setItem("bilyavids_history", JSON.stringify(historyList));
        renderHistory();

        // Optional download
        if (downloadToggle.checked) {
            const fileName = `BilyaVidz_${Math.floor(Math.random() * 1e10)}.mp4`;
            const link = document.createElement("a");
            link.href = videoUrl;
            link.download = fileName;
            link.click();
        }

    } catch (err) {
        console.error(err);
        alert("Error generating video");
    } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate";
    }
};
</script>

</body>
</html>
